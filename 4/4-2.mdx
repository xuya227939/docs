---
title: "搭建后端服务"
---

# GitHub

[docs-backstage](https://github.com/xuya227939/docs-backstage)，从这里 `fork` 下项目到自己的 `github` 仓库

# 后端开发指南 (Backend Development Guide)

这里的示例是 `Node.js` 的后端服务，如果你会前端后端，欢迎使用其他的后端语言，仅做示例参考。这份文档旨在帮助后端工程师快速上手 docs-backstage 项目，涵盖环境配置、API 开发、中间件使用及部署流程。

## 1. 项目概览 (Project Overview)
- **技术栈**: [Hono](https://hono.dev/) (Web 框架) + [Bun](https://bun.sh/) (运行时) + [Cloudflare Workers](https://workers.cloudflare.com/) (部署平台)
- **核心特性**: 高性能、边缘计算、TypeScript 支持

## 2. 环境配置 (Environment Setup)
### 2.1 前置要求
- 安装 [Bun](https://bun.sh/)
- 安装 [Wrangler](https://developers.cloudflare.com/workers/wrangler/install-and-update/) (Cloudflare CLI)

### 2.2 安装与运行
- **安装依赖**: `bun install`
- **本地开发**: `bun run dev` (监听 `src/index.ts`)
- **类型检查**: `bun run type-check`

### 2.3 环境变量
- **本地开发**: 创建 `.env` 文件 (参考 `wrangler.toml` 中的 vars)
- **生产环境**: 在 `wrangler.toml` 中配置 `[vars]` 或通过 Cloudflare Dashboard 设置
- **类型定义**: 在 `src/routes/api.ts` 或全局类型文件中定义 `Env` 接口

## 3. 项目结构 (Project Structure)
```
src/
├── index.ts          # 入口文件 (App 初始化, 全局中间件, 路由挂载)
├── routes/           # 路由定义
│   ├── api.ts        # API 路由模块
│   └── index.ts      # 路由导出
├── middleware/       # 自定义中间件
│   └── core.ts       # CORS 等核心中间件
├── utils/            # 工具函数
└── types/            # TypeScript 类型定义
```

## 4. API 开发 (API Development)
### 4.1 添加新路由
- 在 `src/routes/` 下创建或修改文件 (如 `api.ts`)
- 使用 `app.get`, `app.post` 等方法定义路由
- **示例**:
  ```typescript
  api.get('/hello', (c) => {
    return c.json({ message: 'Hello World' });
  });
  ```

### 4.2 处理请求 (Request Handling)
- **JSON Body**: `const body = await c.req.json();`
- **Query Params**: `const query = c.req.query('q');`
- **Path Params**: `const id = c.req.param('id');`
- **Headers**: `const auth = c.req.header('Authorization');`

### 4.3 发送响应 (Response)
- **JSON**: `return c.json({ data: ... });`
- **Error**: `return c.json({ error: 'Message' }, 400);`

### 4.4 发起外部请求 (External Requests)
- 使用 `axios` (已安装) 或原生 `fetch`
- **示例**:
  ```typescript
  import axios from 'axios';
  const response = await axios.get('https://api.example.com');
  ```

## 5. 中间件 (Middleware)
### 5.1 全局中间件
- 在 `src/index.ts` 中配置
- 已启用: Logger, Timing, PrettyJSON, SecureHeaders, CORS

### 5.2 自定义中间件
- 在 `src/middleware/` 中创建
- 使用 `app.use('*', myMiddleware)` 注册

## 6. 部署 (Deployment)
- **命令**: `bun run deploy` (部署到 Cloudflare Workers)
- **多环境**:
  - Staging: `bun run deploy:staging`
  - Production: `bun run deploy:prod`
- **配置**: 修改 `wrangler.toml` 中的 `[env.production]` 等部分

## 7. 调试与日志 (Debugging)
- 使用 `console.log` 或 `console.error` (Cloudflare Dashboard 可查看日志)
- 本地开发时日志直接输出到终端
